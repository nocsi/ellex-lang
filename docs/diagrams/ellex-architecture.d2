title: Ellex Language Architecture

# User Interfaces Layer
ui_layer: {
  label: "User Interfaces"
  style.fill: "#e3f2fd"
  style.stroke: "#1976d2"
  
  web_playground: {
    label: "Web Playground\nðŸŒ Browser-based IDE\nâ€¢ Real-time execution\nâ€¢ Session management\nâ€¢ Interactive tutorials"
    shape: rectangle
    style.fill: "#bbdefb"
  }
  
  cli_repl: {
    label: "CLI REPL\nðŸ’» Terminal Interface\nâ€¢ Interactive shell\nâ€¢ Command history\nâ€¢ Syntax highlighting"
    shape: rectangle
    style.fill: "#bbdefb"
  }
  
  tui: {
    label: "TUI Interface\nðŸ“Š Terminal UI\nâ€¢ Real-time metrics\nâ€¢ Multi-tab editor\nâ€¢ Visual debugging"
    shape: rectangle
    style.fill: "#bbdefb"
  }
  
  mobile_app: {
    label: "Mobile App\nðŸ“± iOS/Android\nâ€¢ Touch-friendly\nâ€¢ Voice input\nâ€¢ Turtle graphics"
    shape: rectangle
    style.fill: "#bbdefb"
    style.stroke-dash: 5
  }
}

# API Layer
api_layer: {
  label: "API Layer"
  style.fill: "#f3e5f5"
  style.stroke: "#7b1fa2"
  
  rest_api: {
    label: "REST API\nðŸ”Œ HTTP Endpoints\nâ€¢ Session management\nâ€¢ Code execution\nâ€¢ Real-time results"
    shape: rectangle
    style.fill: "#e1bee7"
  }
  
  websocket: {
    label: "WebSocket API\nâš¡ Real-time Communication\nâ€¢ Live execution\nâ€¢ Interactive input\nâ€¢ Stream results"
    shape: rectangle
    style.fill: "#e1bee7"
    style.stroke-dash: 5
  }
  
  graphql: {
    label: "GraphQL API\nðŸ“Š Flexible Queries\nâ€¢ Schema introspection\nâ€¢ Efficient data fetching\nâ€¢ Type safety"
    shape: rectangle
    style.fill: "#e1bee7"
    style.stroke-dash: 5
  }
}

# Core Language Layer
core_layer: {
  label: "Core Language Runtime"
  style.fill: "#e8f5e8"
  style.stroke: "#388e3c"
  
  repl_engine: {
    label: "REPL Engine\nðŸ”„ Interactive Execution\nâ€¢ Session state\nâ€¢ Variable persistence\nâ€¢ Command history\nâ€¢ Error recovery"
    shape: rectangle
    style.fill: "#c8e6c9"
  }
  
  parser: {
    label: "Parser\nðŸ“ Natural Language â†’ AST\nâ€¢ Pest grammar\nâ€¢ Error recovery\nâ€¢ Syntax highlighting\nâ€¢ Auto-completion"
    shape: rectangle
    style.fill: "#c8e6c9"
  }
  
  runtime: {
    label: "Runtime Engine\nâš™ï¸ Code Execution\nâ€¢ Safe execution\nâ€¢ Memory limits\nâ€¢ Timeout protection\nâ€¢ Variable management"
    shape: rectangle
    style.fill: "#c8e6c9"
  }
  
  optimizer: {
    label: "Optimizer Pipeline\nðŸš€ Code Optimization\nâ€¢ Constant folding\nâ€¢ Dead code elimination\nâ€¢ Loop unrolling\nâ€¢ Function inlining"
    shape: rectangle
    style.fill: "#c8e6c9"
  }
}

# Modal Programming Layer
modal_layer: {
  label: "Modal Programming"
  style.fill: "#fce4ec"
  style.stroke: "#c2185b"
  
  listen_mode: {
    label: "@listen Mode\nðŸ‘‚ Exploration\nâ€¢ Code discovery\nâ€¢ Documentation\nâ€¢ Related functions\nâ€¢ Pattern matching"
    shape: rectangle
    style.fill: "#f8bbd9"
  }
  
  think_mode: {
    label: "@think Mode\nðŸ¤” Analysis\nâ€¢ Code understanding\nâ€¢ Impact analysis\nâ€¢ Usage patterns\nâ€¢ Performance insights"
    shape: rectangle
    style.fill: "#f8bbd9"
  }
  
  build_mode: {
    label: "@build Mode\nðŸ”¨ Construction\nâ€¢ Code refactoring\nâ€¢ Function extraction\nâ€¢ Variable renaming\nâ€¢ Structure changes"
    shape: rectangle
    style.fill: "#f8bbd9"
  }
  
  teach_mode: {
    label: "@teach Mode\nðŸŽ“ Education\nâ€¢ Concept explanation\nâ€¢ Example generation\nâ€¢ Learning paths\nâ€¢ Practice suggestions"
    shape: rectangle
    style.fill: "#f8bbd9"
  }
}

# AI & Graphics Layer
ai_graphics_layer: {
  label: "AI & Graphics"
  style.fill: "#fff3e0"
  style.stroke: "#f57c00"
  
  ai_assistant: {
    label: "AI Assistant\nðŸ¤– Intelligent Help\nâ€¢ Code suggestions\nâ€¢ Error explanation\nâ€¢ Learning guidance\nâ€¢ Pattern recognition"
    shape: rectangle
    style.fill: "#ffe0b2"
  }
  
  turtle_graphics: {
    label: "Turtle Graphics\nðŸ¢ Visual Programming\nâ€¢ 2D drawing canvas\nâ€¢ Movement commands\nâ€¢ Color management\nâ€¢ Shape creation"
    shape: rectangle
    style.fill: "#ffe0b2"
  }
  
  visual_editor: {
    label: "Visual Editor\nðŸŽ¨ Block-based UI\nâ€¢ Drag & drop\nâ€¢ Visual connections\nâ€¢ Code generation\nâ€¢ Live preview"
    shape: rectangle
    style.fill: "#ffe0b2"
    style.stroke-dash: 5
  }
}

# Safety & Monitoring Layer
safety_layer: {
  label: "Safety & Monitoring"
  style.fill: "#ffebee"
  style.stroke: "#d32f2f"
  
  safety_monitor: {
    label: "Safety Monitor\nðŸ›¡ï¸ Execution Protection\nâ€¢ Timeout enforcement\nâ€¢ Memory limits\nâ€¢ Recursion depth\nâ€¢ Loop bounds"
    shape: rectangle
    style.fill: "#ffcdd2"
  }
  
  error_handler: {
    label: "Error Handler\nðŸ˜Š Kid-friendly Errors\nâ€¢ Friendly messages\nâ€¢ Helpful suggestions\nâ€¢ Recovery guidance\nâ€¢ Learning opportunities"
    shape: rectangle
    style.fill: "#ffcdd2"
  }
  
  metrics_collector: {
    label: "Metrics Collector\nðŸ“Š Performance Tracking\nâ€¢ Execution time\nâ€¢ Memory usage\nâ€¢ Parse metrics\nâ€¢ User analytics"
    shape: rectangle
    style.fill: "#ffcdd2"
  }
}

# Backend Infrastructure
backend_layer: {
  label: "Backend Infrastructure"
  style.fill: "#f1f8e9"
  style.stroke: "#689f38"
  
  elixir_backend: {
    label: "Elixir Backend\nâš¡ BEAM VM\nâ€¢ Fault tolerance\nâ€¢ Supervision trees\nâ€¢ Hot code reloading\nâ€¢ Distributed computing"
    shape: rectangle
    style.fill: "#dcedc8"
  }
  
  session_manager: {
    label: "Session Manager\nðŸ—‚ï¸ State Management\nâ€¢ User sessions\nâ€¢ Variable persistence\nâ€¢ Function storage\nâ€¢ History tracking"
    shape: rectangle
    style.fill: "#dcedc8"
  }
  
  database: {
    label: "Database\nðŸ’¾ Data Storage\nâ€¢ User progress\nâ€¢ Code snippets\nâ€¢ Learning analytics\nâ€¢ Session backups"
    shape: rectangle
    style.fill: "#dcedc8"
  }
}

# Connections
ui_layer.web_playground -> api_layer.rest_api
ui_layer.cli_repl -> core_layer.repl_engine
ui_layer.tui -> core_layer.repl_engine
ui_layer.mobile_app -> api_layer.websocket

api_layer.rest_api -> core_layer.repl_engine
api_layer.websocket -> core_layer.repl_engine

core_layer.repl_engine -> core_layer.parser
core_layer.parser -> core_layer.runtime
core_layer.runtime -> core_layer.optimizer

core_layer.repl_engine -> modal_layer.listen_mode
core_layer.repl_engine -> modal_layer.think_mode
core_layer.repl_engine -> modal_layer.build_mode
core_layer.repl_engine -> modal_layer.teach_mode

modal_layer.think_mode -> ai_graphics_layer.ai_assistant
modal_layer.teach_mode -> ai_graphics_layer.ai_assistant
core_layer.runtime -> ai_graphics_layer.turtle_graphics

core_layer.runtime -> safety_layer.safety_monitor
core_layer.runtime -> safety_layer.error_handler
core_layer.repl_engine -> safety_layer.metrics_collector

api_layer.rest_api -> backend_layer.session_manager
backend_layer.session_manager -> backend_layer.database
core_layer.runtime -> backend_layer.elixir_backend

# Data Flow Legend
legend: {
  label: "Architecture Legend"
  style.fill: "#f5f5f5"
  style.stroke-dash: 5
  
  solid_line: {
    label: "â€” Implemented"
    shape: text
  }
  
  dashed_line: {
    label: "--- Planned"
    shape: text
  }
  
  user_interfaces: {
    label: "User Interfaces"
    style.fill: "#bbdefb"
    shape: rectangle
  }
  
  api_layer_legend: {
    label: "API Layer"
    style.fill: "#e1bee7"
    shape: rectangle
  }
  
  core_runtime: {
    label: "Core Runtime"
    style.fill: "#c8e6c9"
    shape: rectangle
  }
  
  modal_programming: {
    label: "Modal Programming"
    style.fill: "#f8bbd9"
    shape: rectangle
  }
  
  ai_graphics: {
    label: "AI & Graphics"
    style.fill: "#ffe0b2"
    shape: rectangle
  }
  
  safety_monitoring: {
    label: "Safety & Monitoring"
    style.fill: "#ffcdd2"
    shape: rectangle
  }
  
  backend_infra: {
    label: "Backend Infrastructure"
    style.fill: "#dcedc8"
    shape: rectangle
  }
}